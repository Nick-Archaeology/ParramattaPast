<html>
<head>
    <title>Parramatta Past</title>
    <link rel="stylesheet" type="text/css" href="leaflet.css" />
    <script src="leaflet.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
    <script src="leaflet.ajax.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

</head>
<body>
    <div id="mapid"></div>
    <script>
        //function for showing popups on GeoJSON files
        function showPopup(feature, layer) {
            var key, val;
            var content = [];
            for (key in feature.properties) {
                val = feature.properties[key];
                if (key == 'ITEMNAME') {
                    content.push("<strong>" + val + "</strong>");
                }
                if (key == 'Item_Link') {
                    content.push('<a href="' + val + '" target="_blank"> Link to State Heritage Listing');
                }
            }
            layer.bindPopup(content.join("<br />"));
        }
        
        //Modern map
        var mapbox = L.tileLayer('https://api.mapbox.com/styles/v1/nickpitt/cipujdo6h004abakwjtnzg7dq/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoibmlja3BpdHQiLCJhIjoiY2lvczV6YWN6MDA2NXR3bTg1aHo2MHFrbiJ9.Q202ChZydvxJnOnlle84IQ', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'nickpitt/cios6117x000oaykop4vni8cx',
        accessToken: 'pk.eyJ1Ijoibmlja3BpdHQiLCJhIjoiY2lvczV6YWN6MDA2NXR3bTg1aHo2MHFrbiJ9.Q202ChZydvxJnOnlle84IQ'
        });
        
        //Historic maps
        var Parra1880s = L.tileLayer('http://mapwarper.net/maps/tile/16011/{z}/{x}/{y}.png',{
           attribution: 'Higginbotham & Robinson, Atlas of Sydney Suburbs, c.1889-1894, <a href="http://www.photosau.com.au/cosmaps/scripts/home.asp">City of Sydney Archives - Historical Atlas of Sydney</a>, Georeferenced using <a href="http://mapwarper.net/maps/16011">Map Warper</a>'
        });
        
        var Parra1858 = L.tileLayer('http://mapwarper.net/maps/tile/16009/{z}/{x}/{y}.png ',{
            attribution: 'Map of Extension Parramatta to Penrith Part 1, 1858, <a href="https://www.records.nsw.gov.au/image/map-extension-parramatta-penrith-part-1">SRNSW Digital ID: 15244_a103_a1030000001</a>, Georeferenced using <a href="http://mapwarper.net/maps/16009">Map Warper</a>'
        });
        
        //Aerial Imagery
        var NSW_Image = L.tileLayer.wms('http://maps.six.nsw.gov.au/arcgis/services/public/NSW_Imagery/MapServer/WMSServer?',{
            layers: 'BestImageryDates',
            attribution: 'Imagery &copy; <a href="http://spatialservices.finance.nsw.gov.au/mapping_and_imagery/lpi_web_services">NSW Government, CC-BY-A</a>'
        });
        
        //Places listed on the blog
        var OldGovHouse = L.marker([-33.812159, 150.997341]).bindPopup('<a href="http://parramattapast.tumblr.com/post/151921026195/building-of-the-week-old-government-housethis" target="_blank">Old Government House</a>');
        
        var BlogPlaces = L.layerGroup([OldGovHouse]);
        
        //Leaflet map which ties them all together
        var mymap = L.map('mapid', {
            center: [-33.81124,151.003403],
            zoom: 15,
            layers: [mapbox, Parra1880s, BlogPlaces]
        });
        
        //Places on NSW State Heritage Register
        var SHR_Sites = new L.GeoJSON.AJAX("Parra_SHR_polygons.geojson", {
            onEachFeature: showPopup,
            color: '#3498db',
            fillColor: '#85c1e9',
            attribution: 'NSW State Heritage Register locations, <a href="http://data.nsw.gov.au/data/dataset/65802c9d-7914-4ecb-a37b-da92e179293e">NSW Office of Environment and Heritage</a> CC-BY-A'
        });
        
        var baseLayers = {
            "Mapbox": mapbox,
            "NSW Imagery": NSW_Image
        };
        var overlayMaps = {
            "1858": Parra1858,
            "1880s": Parra1880s,
            "Locations on Tumblr": BlogPlaces,
            "State Heritage Register Places": SHR_Sites
        };
        
        //Control box for switching between layers
        L.control.layers(baseLayers,overlayMaps).addTo(mymap);

        
        
    </script>
</body>
